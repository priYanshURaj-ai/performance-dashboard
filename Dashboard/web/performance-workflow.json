{
    "name": "Performance Dashboard - Data Generator",
    "nodes": [
        {
            "parameters": {
                "content": "## ğŸ“Š Performance Dashboard Workflow\n\n### Purpose\nFetches JIRA data daily at 9:30 PM IST and generates performance metrics for all team members across 3 time periods:\n- **Last 7 Days**\n- **Last 15 Days**\n- **Last 30 Days**\n\n### Flow\n```\nDaily 9:30 PM IST\n    â†“\nFetch JIRA (30 days - single call)\n    â†“\nFilter & Aggregate Per Period\n    â†“\nSend to Dashboard\n```\n\n### Features\n- Multi-component support\n- Estimated hours from JIRA\n- Hours logged tracking\n- Sprint metrics\n\n### Components (DYNAMIC)\nBot Engine, RE Platform 2.0"
            },
            "id": "workflow-doc",
            "name": "ğŸ“‹ Documentation",
            "type": "n8n-nodes-base.stickyNote",
            "typeVersion": 1,
            "position": [-200, 200]
        },
        {
            "parameters": {
                "rule": {
                    "interval": [{ "field": "cronExpression", "expression": "0 16 * * *" }]
                }
            },
            "id": "daily-trigger",
            "name": "Daily 9:30 PM IST",
            "type": "n8n-nodes-base.scheduleTrigger",
            "typeVersion": 1.2,
            "position": [100, 400],
            "notes": "9:30 PM IST = 4:00 PM UTC (16:00)"
        },
        {
            "parameters": {},
            "id": "manual-trigger",
            "name": "Manual Trigger",
            "type": "n8n-nodes-base.manualTrigger",
            "typeVersion": 1,
            "position": [100, 600]
        },
        {
            "parameters": {
                "jsCode": "// ========================================\n// CONFIGURATION - MULTI-COMPONENT SUPPORT\n// ========================================\nconst BOARD_COMPONENTS = ['Bot Engine', 'RE Platform 2.0'];\nconst PROJECT_KEY = 'PAI';\nconst HOURS_PER_DAY = 8;\n// ========================================\n\nconst teamMembers = [\n  { name: \"Sreerag Unnikrishnan\", email: \"sreerag.unnikrishnan@paytm.com\", avatar: \"SU\" },\n  { name: \"Dinesh Kumar\", email: \"dinesh34.kumar@paytm.com\", avatar: \"DK\" },\n  { name: \"Huan Zheng\", email: \"huan.zheng@paytm.com\", avatar: \"HZ\" },\n  { name: \"Keshav Sharma\", email: \"keshav4.sharma@paytm.com\", avatar: \"KS\" },\n  { name: \"Kshitiz Gupta\", email: \"kshitiz1.gupta@paytm.com\", avatar: \"KG\" },\n  { name: \"Pankaj Sirohi\", email: \"pankaj.sirohi@paytm.com\", avatar: \"PS\" },\n  { name: \"Rohit Mishra\", email: \"rohit8.mishra@paytmpayments.com\", avatar: \"RM\" },\n  { name: \"Arijit Bhattacharyya\", email: \"Arijit.bhattacharyya@paytm.com\", avatar: \"AB\" },\n  { name: \"Aditya Shahi\", email: \"aditya.shahi@paytm.com\", avatar: \"AS\" },\n  { name: \"Amit Tomar\", email: \"amit2.tomar@paytm.com\", avatar: \"AT\" },\n  { name: \"Arjit Gupta\", email: \"arjit.gupta@paytm.com\", avatar: \"AG\" },\n  { name: \"Britelyne Dass\", email: \"britelyne.dass@paytm.com\", avatar: \"BD\" },\n  { name: \"Eshita Gupta\", email: \"eshita1.gupta@paytm.com\", avatar: \"EG\" },\n  { name: \"Girish Kumar\", email: \"girish3.kumar@paytm.com\", avatar: \"GK\" },\n  { name: \"Pappu Kumar\", email: \"pappu1.kumar@paytm.com\", avatar: \"PK\" },\n  { name: \"Sanyam Jain\", email: \"sanyam1.jain@paytm.com\", avatar: \"SJ\" },\n  { name: \"Deepak Rawat\", email: \"deepak5.rawat@paytm.com\", avatar: \"DR\" },\n  { name: \"Prakarsh Srivastava\", email: \"prakarsh.srivastava@paytm.com\", avatar: \"PS\" },\n  { name: \"Abhishek Keshari\", email: \"abhishek.keshari@paytm.com\", avatar: \"AK\" },\n  { name: \"Anand Yadav\", email: \"anand3.yadav@paytm.com\", avatar: \"AY\" },\n  { name: \"Anshul Chauhan\", email: \"anshul1.chauhan@paytm.com\", avatar: \"AC\" },\n  { name: \"Apurva Ninave\", email: \"apurva.ninave@paytm.com\", avatar: \"AN\" },\n  { name: \"Babaji Komali\", email: \"babaji.komali@paytm.com\", avatar: \"BK\" },\n  { name: \"Deepika Suyal\", email: \"deepika.suyal@paytm.com\", avatar: \"DS\" },\n  { name: \"Tushar Aggarwal\", email: \"tushar1.aggarwal@paytm.com\", avatar: \"TA\" }\n];\n\nconst today = new Date();\nconst formatDate = (d) => d.toISOString().split('T')[0];\nconst getDateDaysAgo = (days) => { const d = new Date(today); d.setDate(d.getDate() - days); return formatDate(d); };\n\n// Sprint calculation\nconst getNthMondayOfMonth = (year, month, n) => {\n  const firstDay = new Date(year, month, 1);\n  const dayOfWeek = firstDay.getDay();\n  const firstMonday = dayOfWeek <= 1 ? 1 + (1 - dayOfWeek) : 1 + (8 - dayOfWeek);\n  return new Date(year, month, firstMonday + (n - 1) * 7);\n};\n\nconst getSprintDates = (ref) => {\n  const year = ref.getFullYear(), month = ref.getMonth();\n  const firstMonday = getNthMondayOfMonth(year, month, 1);\n  const thirdMonday = getNthMondayOfMonth(year, month, 3);\n  const nextMonth = month === 11 ? 0 : month + 1;\n  const nextYear = month === 11 ? year + 1 : year;\n  const nextFirstMonday = getNthMondayOfMonth(nextYear, nextMonth, 1);\n  \n  let current, previous;\n  if (ref >= thirdMonday) {\n    current = { name: 'Sprint 2', number: 2, startDate: thirdMonday, endDate: new Date(nextFirstMonday.getTime() - 1), month: ref.toLocaleString('en-US', { month: 'short' }), year };\n    previous = { name: 'Sprint 1', number: 1, startDate: firstMonday, endDate: new Date(thirdMonday.getTime() - 1), month: ref.toLocaleString('en-US', { month: 'short' }), year };\n  } else if (ref >= firstMonday) {\n    current = { name: 'Sprint 1', number: 1, startDate: firstMonday, endDate: new Date(thirdMonday.getTime() - 1), month: ref.toLocaleString('en-US', { month: 'short' }), year };\n    const pm = month === 0 ? 11 : month - 1, py = month === 0 ? year - 1 : year;\n    previous = { name: 'Sprint 2', number: 2, startDate: getNthMondayOfMonth(py, pm, 3), endDate: new Date(firstMonday.getTime() - 1), month: new Date(py, pm).toLocaleString('en-US', { month: 'short' }), year: py };\n  } else {\n    const pm = month === 0 ? 11 : month - 1, py = month === 0 ? year - 1 : year;\n    current = { name: 'Sprint 2', number: 2, startDate: getNthMondayOfMonth(py, pm, 3), endDate: new Date(firstMonday.getTime() - 1), month: new Date(py, pm).toLocaleString('en-US', { month: 'short' }), year: py };\n    previous = { name: 'Sprint 1', number: 1, startDate: getNthMondayOfMonth(py, pm, 1), endDate: new Date(getNthMondayOfMonth(py, pm, 3).getTime() - 1), month: new Date(py, pm).toLocaleString('en-US', { month: 'short' }), year: py };\n  }\n  \n  const countWorkingDays = (s, e) => { let c = 0; const cur = new Date(s); while (cur <= e) { if (cur.getDay() !== 0 && cur.getDay() !== 6) c++; cur.setDate(cur.getDate() + 1); } return c; };\n  \n  current.workingDays = countWorkingDays(current.startDate, current.endDate);\n  current.totalHours = current.workingDays * HOURS_PER_DAY;\n  const todayEnd = new Date(ref); todayEnd.setHours(23, 59, 59, 999);\n  current.elapsedWorkingDays = countWorkingDays(current.startDate, todayEnd);\n  current.elapsedHours = current.elapsedWorkingDays * HOURS_PER_DAY;\n  current.sprintDay = current.elapsedWorkingDays;\n  current.label = `${current.month} ${current.name}`;\n  current.dateRange = `${formatDate(current.startDate)} to ${formatDate(current.endDate)}`;\n  \n  previous.workingDays = countWorkingDays(previous.startDate, previous.endDate);\n  previous.totalHours = previous.workingDays * HOURS_PER_DAY;\n  previous.elapsedWorkingDays = previous.workingDays;\n  previous.elapsedHours = previous.totalHours;\n  previous.sprintDay = previous.workingDays;\n  previous.label = `${previous.month} ${previous.name}`;\n  previous.dateRange = `${formatDate(previous.startDate)} to ${formatDate(previous.endDate)}`;\n  \n  return { current, previous };\n};\n\nconst sprints = getSprintDates(today);\nconst periods = {\n  '7days': { start: getDateDaysAgo(7), end: formatDate(today), label: 'Last 7 Days' },\n  '15days': { start: getDateDaysAgo(15), end: formatDate(today), label: 'Last 15 Days' },\n  '30days': { start: getDateDaysAgo(30), end: formatDate(today), label: 'Last 30 Days' }\n};\n\nreturn [{ json: { boardComponents: BOARD_COMPONENTS, projectKey: PROJECT_KEY, hoursPerDay: HOURS_PER_DAY, teamMembers, periods, sprints: { current: { ...sprints.current, startDate: formatDate(sprints.current.startDate), endDate: formatDate(sprints.current.endDate) }, previous: { ...sprints.previous, startDate: formatDate(sprints.previous.startDate), endDate: formatDate(sprints.previous.endDate) } }, today: formatDate(today), timestamp: today.toISOString() } }];"
            },
            "id": "config-setup",
            "name": "âš™ï¸ Setup Config",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [350, 500]
        },
        {
            "parameters": {
                "operation": "getAll",
                "returnAll": true,
                "options": {
                    "fieldsByKey": false,
                    "jql": "project = PAI AND component IN (\"Bot Engine\", \"RE Platform 2.0\") AND updated >= -30d ORDER BY updated DESC"
                }
            },
            "id": "jira-all",
            "name": "ğŸ“¥ JIRA - All Data (30 Days)",
            "type": "n8n-nodes-base.jira",
            "typeVersion": 1,
            "position": [600, 500],
            "alwaysOutputData": true,
            "credentials": {
                "jiraSoftwareCloudApi": {
                    "id": "GFoi8KotNCCPvlLK",
                    "name": "Jira SW Cloud account 7"
                }
            }
        },
        {
            "parameters": {
                "jsCode": "// Process JIRA data - INCLUDES ESTIMATED HOURS\nconst configData = $('âš™ï¸ Setup Config').first().json;\nconst { teamMembers, boardComponents, projectKey, sprints } = configData;\n\nconst rawIssues = $('ğŸ“¥ JIRA - All Data (30 Days)').all().map(i => i.json);\nconsole.log(`ğŸ“Š Total issues: ${rawIssues.length}`);\n\nconst allIssues = rawIssues.filter(issue => {\n  const comps = issue.fields?.components || [];\n  return comps.some(c => boardComponents.includes(c.name));\n});\nconsole.log(`ğŸ“Š Filtered issues: ${allIssues.length}`);\n\nconst now = new Date();\nconst cutoff7d = new Date(now); cutoff7d.setDate(now.getDate() - 7);\nconst cutoff15d = new Date(now); cutoff15d.setDate(now.getDate() - 15);\n\nconst currentSprintStart = new Date(sprints.current.startDate);\nconst currentSprintEnd = new Date(sprints.current.endDate); currentSprintEnd.setHours(23,59,59,999);\nconst prevSprintStart = new Date(sprints.previous.startDate);\nconst prevSprintEnd = new Date(sprints.previous.endDate); prevSprintEnd.setHours(23,59,59,999);\n\nconst filterByPeriod = (issues, cutoff) => issues.filter(i => new Date(i.fields?.updated || i.fields?.created) >= cutoff);\nconst filterBySprint = (issues, start, end) => issues.filter(i => { const d = new Date(i.fields?.created); return d >= start && d <= end; });\n\nconst issues7d = filterByPeriod(allIssues, cutoff7d);\nconst issues15d = filterByPeriod(allIssues, cutoff15d);\nconst issues30d = allIssues;\nconst issuesCurrent = filterBySprint(allIssues, currentSprintStart, currentSprintEnd);\nconst issuesPrev = filterBySprint(allIssues, prevSprintStart, prevSprintEnd);\n\nconst boardInfo = { name: boardComponents.join(' & '), project: projectKey, components: boardComponents };\n\nconst statusMap = {\n  'To Do': 'toDo', 'TO DO': 'toDo', 'Open': 'toDo', 'Backlog': 'toDo', 'New': 'toDo',\n  'In Progress': 'inProgress', 'IN PROGRESS': 'inProgress', 'In Review': 'inProgress', 'Code Review': 'inProgress', 'In Development': 'inProgress',\n  'UAT': 'uat', 'QA': 'uat', 'Testing': 'uat', 'Ready for UAT': 'uat',\n  'Done': 'done', 'DONE': 'done', 'Closed': 'done', 'Resolved': 'done', 'Complete': 'done', 'Completed': 'done'\n};\nconst getStatus = (s) => statusMap[s] || 'toDo';\n\nconst isAssignee = (issue, email) => {\n  const a = issue.fields?.assignee;\n  if (!a) return false;\n  const el = email.toLowerCase(), ep = el.split('@')[0];\n  const ae = (a.emailAddress || '').toLowerCase();\n  if (ae === el || ae.includes(ep)) return true;\n  const dn = (a.displayName || '').toLowerCase();\n  const parts = ep.replace(/[0-9]/g, '').replace(/\\./g, ' ').split(' ').filter(p => p.length > 2);\n  return parts.length > 0 && parts.every(p => dn.includes(p));\n};\n\n// Get issues with ESTIMATED + LOGGED hours\nconst getIssuesWithTime = (issues, email) => issues.filter(i => isAssignee(i, email)).map(i => {\n  const spent = (i.fields?.timespent || 0) / 3600;\n  const estimated = (i.fields?.timeoriginalestimate || 0) / 3600;\n  return {\n    key: i.key, summary: i.fields?.summary || '',\n    status: getStatus(i.fields?.status?.name || 'To Do'),\n    statusName: i.fields?.status?.name || 'To Do',\n    timeSpentHours: Math.round(spent * 10) / 10,\n    estimatedHours: Math.round(estimated * 10) / 10,\n    priority: i.fields?.priority?.name || 'Medium',\n    created: i.fields?.created\n  };\n});\n\n// Calculate metrics with ESTIMATED HOURS\nconst getMetrics = (issues, email) => {\n  const memberIssues = getIssuesWithTime(issues, email);\n  const counts = { total: memberIssues.length, done: 0, inProgress: 0, uat: 0, toDo: 0 };\n  let logged = 0, estimated = 0;\n  memberIssues.forEach(i => { counts[i.status]++; logged += i.timeSpentHours; estimated += i.estimatedHours; });\n  const topIssues = memberIssues.filter(i => i.timeSpentHours > 0).sort((a,b) => b.timeSpentHours - a.timeSpentHours).slice(0,4)\n    .map(i => ({ key: i.key, summary: i.summary, status: i.status, statusName: i.statusName, hours: i.timeSpentHours, estimated: i.estimatedHours }));\n  return { ...counts, hoursLogged: Math.round(logged * 10) / 10, estimatedHours: Math.round(estimated * 10) / 10, topIssues };\n};\n\nconst getSprintMetrics = (issues, email, sprintInfo) => {\n  const memberIssues = getIssuesWithTime(issues, email);\n  const counts = { total: memberIssues.length, done: 0, inProgress: 0, uat: 0, toDo: 0 };\n  let logged = 0, estimated = 0;\n  memberIssues.forEach(i => { counts[i.status]++; logged += i.timeSpentHours; estimated += i.estimatedHours; });\n  const topIssues = memberIssues.filter(i => i.timeSpentHours > 0).sort((a,b) => b.timeSpentHours - a.timeSpentHours).slice(0,4)\n    .map(i => ({ key: i.key, summary: i.summary, status: i.status, statusName: i.statusName, hours: i.timeSpentHours, estimated: i.estimatedHours }));\n  const allIssues = memberIssues.map(i => ({ key: i.key, summary: i.summary, status: i.status, statusName: i.statusName, hours: i.timeSpentHours, estimated: i.estimatedHours }));\n  return { ...counts, hoursLogged: Math.round(logged * 10) / 10, estimatedHours: Math.round(estimated * 10) / 10, totalHours: sprintInfo.totalHours, workingDays: sprintInfo.workingDays, topIssues, allIssues };\n};\n\nconst teamSummary = (issues) => {\n  const s = { total: issues.length, done: 0, inProgress: 0, uat: 0, toDo: 0, totalHoursLogged: 0, totalEstimatedHours: 0 };\n  issues.forEach(i => { s[getStatus(i.fields?.status?.name || 'To Do')]++; s.totalHoursLogged += (i.fields?.timespent || 0) / 3600; s.totalEstimatedHours += (i.fields?.timeoriginalestimate || 0) / 3600; });\n  s.totalHoursLogged = Math.round(s.totalHoursLogged * 10) / 10;\n  s.totalEstimatedHours = Math.round(s.totalEstimatedHours * 10) / 10;\n  return s;\n};\n\nconst output = {\n  lastUpdated: new Date().toISOString(),\n  generatedAt: configData.timestamp,\n  boardInfo,\n  workingHours: { '7days': 40, '15days': 88, '30days': 176 },\n  sprints: configData.sprints,\n  periods: {\n    '7days': { label: 'Last 7 Days', startDate: configData.periods['7days'].start, endDate: configData.periods['7days'].end },\n    '15days': { label: 'Last 15 Days', startDate: configData.periods['15days'].start, endDate: configData.periods['15days'].end },\n    '30days': { label: 'Last 30 Days', startDate: configData.periods['30days'].start, endDate: configData.periods['30days'].end }\n  },\n  teamSummary: {\n    '7days': teamSummary(issues7d), '15days': teamSummary(issues15d), '30days': teamSummary(issues30d),\n    'currentSprint': teamSummary(issuesCurrent), 'previousSprint': teamSummary(issuesPrev)\n  },\n  members: teamMembers.map(m => ({\n    name: m.name, email: m.email, avatar: m.avatar,\n    metrics: { '7days': getMetrics(issues7d, m.email), '15days': getMetrics(issues15d, m.email), '30days': getMetrics(issues30d, m.email) },\n    sprintMetrics: { current: getSprintMetrics(issuesCurrent, m.email, sprints.current), previous: getSprintMetrics(issuesPrev, m.email, sprints.previous) }\n  }))\n};\n\nconsole.log(`âœ… Done! Members: ${output.members.length}`);\nreturn [{ json: output }];"
            },
            "id": "process-data",
            "name": "ğŸ“Š Process & Aggregate",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [850, 500]
        },
        {
            "parameters": {
                "jsCode": "const data = $input.first().json;\nconsole.log('=== Performance Dashboard ===');\nconsole.log(`Boards: ${data.boardInfo.name}`);\nconsole.log(`Members: ${data.members.length}`);\nconsole.log(`7d Total: ${data.teamSummary['7days'].total}`);\nreturn [{ json: { performanceData: data, jsonString: JSON.stringify(data, null, 2) } }];"
            },
            "id": "format-output",
            "name": "ğŸ“ Format Output",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [1100, 500]
        },
        {
            "parameters": {
                "method": "PUT",
                "url": "https://api.jsonbin.io/v3/b/693bb6c643b1c97be9e88bb7",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        { "name": "Content-Type", "value": "application/json" },
                        { "name": "X-Master-Key", "value": "$2a$10$XfkJ1nMj.ioZl6ieqlwNYu.s0DV9LLit5hf6qjj3lFC0Vsz0wSsye" }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={{ JSON.stringify($json.performanceData) }}",
                "options": { "timeout": 30000 }
            },
            "id": "webhook-output",
            "name": "ğŸŒ Save to JSONBin",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [1350, 400],
            "disabled": false
        },
        {
            "parameters": {
                "jsCode": "console.log('âœ… Dashboard data saved!');\nreturn [{ json: { status: 'success', timestamp: new Date().toISOString() } }];"
            },
            "id": "success-log",
            "name": "âœ… Success",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [1600, 500]
        },
        {
            "parameters": {
                "content": "## ğŸ”§ Configuration\n\n### Board Components\n```\nconst BOARD_COMPONENTS = ['Bot Engine', 'RE Platform 2.0'];\n```\n\n### JIRA Fields Used\n- `timespent` - Hours logged\n- `timeoriginalestimate` - Estimated hours\n\n### JSONBin.io\n- Bin ID: 693bb6c643b1c97be9e88bb7"
            },
            "id": "config-note",
            "name": "ğŸ”§ Config Notes",
            "type": "n8n-nodes-base.stickyNote",
            "typeVersion": 1,
            "position": [100, 800]
        }
    ],
    "connections": {
        "Daily 9:30 PM IST": { "main": [[{ "node": "âš™ï¸ Setup Config", "type": "main", "index": 0 }]] },
        "Manual Trigger": { "main": [[{ "node": "âš™ï¸ Setup Config", "type": "main", "index": 0 }]] },
        "âš™ï¸ Setup Config": { "main": [[{ "node": "ğŸ“¥ JIRA - All Data (30 Days)", "type": "main", "index": 0 }]] },
        "ğŸ“¥ JIRA - All Data (30 Days)": { "main": [[{ "node": "ğŸ“Š Process & Aggregate", "type": "main", "index": 0 }]] },
        "ğŸ“Š Process & Aggregate": { "main": [[{ "node": "ğŸ“ Format Output", "type": "main", "index": 0 }]] },
        "ğŸ“ Format Output": { "main": [[{ "node": "ğŸŒ Save to JSONBin", "type": "main", "index": 0 }]] },
        "ğŸŒ Save to JSONBin": { "main": [[{ "node": "âœ… Success", "type": "main", "index": 0 }]] }
    },
    "active": false,
    "settings": { "executionOrder": "v1" },
    "versionId": "v3-estimated-hours",
    "id": "performance-dashboard-workflow",
    "meta": { "instanceId": "performance-bot" },
    "tags": []
}
